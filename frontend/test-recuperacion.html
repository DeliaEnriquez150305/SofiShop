<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Test - Sistema de Recuperaci√≥n</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    h1 { color: #20B997; }
    h2 { color: #0B5345; font-size: 18px; margin-top: 0; }

    .test-case {
      margin: 15px 0;
      padding: 10px;
      background: #f9f9f9;
      border-left: 4px solid #20B997;
    }

    button {
      background: #20B997;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px 5px 5px 0;
    }

    button:hover { background: #17a2a2; }

    .response {
      background: #f0f8f7;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      font-size: 12px;
      font-family: monospace;
      max-height: 200px;
      overflow-y: auto;
    }

    .success { border-left-color: #28a745; }
    .error { border-left-color: #dc3545; }
  </style>
</head>
<body>
  <h1>üîê Test - Sistema de Recuperaci√≥n de Contrase√±a</h1>

  <div class="test-section">
    <h2>1. Solicitar Recuperaci√≥n de Contrase√±a</h2>
    <div class="test-case">
      <p>Email: <strong>deliaenriquez150305@gmail.com</strong></p>
      <button onclick="testForgotPassword('deliaenriquez150305@gmail.com')">
        üìß Enviar Solicitud
      </button>
      <div id="forgotResponse" class="response" style="display:none;"></div>
    </div>
  </div>

  <div class="test-section">
    <h2>2. Rutas Frontend Disponibles</h2>
    <div class="test-case">
      <p>‚úÖ <strong>forgot-password.html</strong> - Solicitar recuperaci√≥n</p>
      <button onclick="window.open('forgot-password.html', '_blank')">
        Abrir P√°gina
      </button>
    </div>
    <div class="test-case">
      <p>‚úÖ <strong>reset-password.html</strong> - Restablecer contrase√±a (requiere token)</p>
      <button onclick="testResetPasswordPage()">
        Ir a P√°gina de Reset
      </button>
    </div>
    <div class="test-case">
      <p>‚úÖ <strong>verify-email.html</strong> - Verificar email (requiere token)</p>
      <button onclick="testVerifyEmailPage()">
        Ir a P√°gina de Verificaci√≥n
      </button>
    </div>
  </div>

  <div class="test-section">
    <h2>3. Informaci√≥n de Usuarios</h2>
    <div class="test-case">
      <p><strong>Admin:</strong> compras.sofishop@gmail.com / Sofia2022...</p>
      <p><strong>Cliente:</strong> deliaenriquez150305@gmail.com / usuario123</p>
    </div>
  </div>

  <div class="test-section">
    <h2>4. Flujo de Recuperaci√≥n</h2>
    <ol>
      <li>Usuario ingresa email en <strong>forgot-password.html</strong></li>
      <li>Backend genera token de recuperaci√≥n (1 hora validez)</li>
      <li>Se env√≠a email con enlace: <code>reset-password.html?token=xxxxx</code></li>
      <li>Usuario abre enlace y establece nueva contrase√±a</li>
      <li>Backend valida token y actualiza contrase√±a</li>
      <li>Usuario puede iniciar sesi√≥n con nueva contrase√±a</li>
    </ol>
  </div>

  <script>
    async function testForgotPassword(email) {
      const btn = event.target;
      btn.disabled = true;
      btn.textContent = 'Enviando...';

      try {
        const response = await fetch('https://sofishop-20.onrender.com/api/auth/forgot-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });

        const data = await response.json();
        const responseDiv = document.getElementById('forgotResponse');
        responseDiv.style.display = 'block';

        if (response.ok) {
          responseDiv.className = 'response success';
          responseDiv.innerHTML = `
            <strong>‚úÖ √âxito:</strong><br>
            ${data.mensaje}<br><br>
            <strong>Token generado y email enviado</strong><br>
            (Revisa tu email para el enlace de recuperaci√≥n)
          `;
        } else {
          responseDiv.className = 'response error';
          responseDiv.innerHTML = `
            <strong>‚ùå Error:</strong><br>
            ${data.mensaje}
          `;
        }
      } catch (error) {
        const responseDiv = document.getElementById('forgotResponse');
        responseDiv.style.display = 'block';
        responseDiv.className = 'response error';
        responseDiv.innerHTML = `<strong>‚ùå Error:</strong> ${error.message}`;
      } finally {
        btn.disabled = false;
        btn.textContent = 'üìß Enviar Solicitud';
      }
    }

    function testResetPasswordPage() {
      const token = prompt('Ingresa el token de recuperaci√≥n (o deja vac√≠o para ver p√°gina de error):');
      if (token !== null) {
        if (token) {
          window.open(`reset-password.html?token=${token}`, '_blank');
        } else {
          window.open('reset-password.html', '_blank');
        }
      }
    }

    function testVerifyEmailPage() {
      const token = prompt('Ingresa el token de verificaci√≥n (o deja vac√≠o para ver p√°gina de error):');
      if (token !== null) {
        if (token) {
          window.open(`verify-email.html?token=${token}`, '_blank');
        } else {
          window.open('verify-email.html', '_blank');
        }
      }
    }
  </script>
</body>
</html>
