<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Perfumes - SofiShop</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #20B997;
      --primary-light: #6FD5C3;
      --secondary: #0B5345;
      --accent: #C3FAE8;
      --text: #2c2c2c;
      --light-bg: #F1F8F6;
      --border: #A8E6D5;
      --shadow: 0 8px 32px rgba(32, 185, 151, 0.12);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      background: var(--light-bg);
      font-family: "Poppins", "Segoe UI", sans-serif;
      color: var(--text);
      width: 100%;
      margin: 0;
      padding: 0 0 0 0;
      overflow-x: hidden;
    }

    .navbar {
      background: white;
      padding: 18px 40px;
      box-shadow: var(--shadow-sm);
      position: sticky;
      top: 0;
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border);
    }

    .navbar-left {
      display: flex;
      align-items: center;
      gap: 35px;
    }

    .logo {
      font-size: 1.8em;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary) 0%, #d46a99 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      cursor: pointer;
      letter-spacing: -0.5px;
      transition: all 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    .nav-link {
      color: var(--text);
      text-decoration: none;
      font-weight: 600;
      font-size: 0.95em;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .nav-link:hover {
      color: var(--primary);
    }

    .nav-link.active {
      color: var(--primary);
      font-weight: 700;
    }

    .nav-link.active::after {
      width: 100%;
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--primary);
      transition: width 0.3s ease;
    }

    .nav-link:hover::after {
      width: 100%;
    }

    .navbar-right {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .nav-btn {
      padding: 10px 18px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .nav-btn-notif {
      position: relative;
      background: linear-gradient(135deg, var(--primary) 0%, #d46a99 100%);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 0;
      outline: none;
      box-shadow: none;
    }

    .nav-btn-notif:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(199, 65, 123, 0.4);
    }

    .nav-btn-notif:focus,
    .nav-btn-notif:focus-visible {
      outline: none;
      box-shadow: none;
    }

    .notif-menu {
      position: relative;
      display: flex;
      align-items: center;
    }

    .notif-badge {
      position: absolute;
      top: 0px;
      right: 0px;
      background: #ff3b30;
      color: white;
      border-radius: 50%;
      min-width: 18px;
      height: 18px;
      padding: 0 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 700;
      border: 2px solid white;
      box-shadow: 0 2px 6px rgba(255, 59, 48, 0.5);
    }

    .notif-dropdown {
      position: absolute;
      top: calc(100% + 15px);
      right: -80px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
      border: 1px solid #e0e0e0;
      width: 380px;
      max-height: 500px;
      display: none;
      z-index: 9999;
      overflow: hidden;
    }

    .notif-dropdown::before {
      content: '';
      position: absolute;
      top: -6px;
      right: 90px;
      width: 12px;
      height: 12px;
      background: white;
      border-left: 1px solid #e0e0e0;
      border-top: 1px solid #e0e0e0;
      transform: rotate(45deg);
    }

    .notif-dropdown.activo {
      display: block;
      animation: fadeInDown 0.3s ease;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .notif-header {
      background: linear-gradient(135deg, var(--primary) 0%, #17a085 100%);
      color: white;
      padding: 16px 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .notif-header h3 {
      margin: 0;
      font-size: 1em;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-marcar-leidas {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.7em;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .btn-marcar-leidas:hover {
      background: rgba(255, 255, 255, 0.35);
    }

    .notif-lista {
      max-height: 400px;
      overflow-y: auto;
      background: white;
    }

    .notif-lista::-webkit-scrollbar {
      width: 6px;
    }

    .notif-lista::-webkit-scrollbar-thumb {
      background: #d0d0d0;
      border-radius: 10px;
    }

    .notif-lista::-webkit-scrollbar-track {
      background: #f5f5f5;
    }

    .notif-vacia {
      padding: 50px 20px;
      text-align: center;
      color: #999;
      font-size: 0.9em;
    }

    .notif-item {
      padding: 14px 16px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      gap: 12px;
      align-items: start;
      background: white;
      position: relative;
    }

    .notif-item:hover {
      background: #f9f9f9;
    }

    .notif-item:last-child {
      border-bottom: none;
    }

    .notif-item.no-leida {
      background: #f0fbf9;
      border-left: 3px solid var(--primary);
    }

    .notif-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--primary) 0%, #17a085 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2em;
      flex-shrink: 0;
    }

    .notif-content {
      flex: 1;
      min-width: 0;
    }

    .notif-mensaje {
      font-size: 0.85em;
      color: var(--text);
      margin: 0 0 4px 0;
    }

    .notif-fecha {
      font-size: 0.75em;
      color: #999;
      margin: 0;
    }

    .nav-btn-cart {
      background: linear-gradient(135deg, var(--primary) 0%, #d46a99 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(199, 65, 123, 0.3);
    }

    .nav-btn-cart:hover {
      background: linear-gradient(135deg, var(--primary) 0%, #d46a99 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(199, 65, 123, 0.4);
    }

    .nav-btn-logout {
      background: #f5f5f5;
      color: var(--text);
      border: 1px solid var(--border);
    }

    .nav-btn-logout:hover {
      background: var(--accent);
      border-color: var(--primary);
    }

    .nav-btn-admin {
      background: linear-gradient(135deg, var(--primary) 0%, #d46a99 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(199, 65, 123, 0.3);
    }

    .nav-btn-admin:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(199, 65, 123, 0.4);
    }

    #admin-btn {
      display: none;
    }

    .user-menu {
      position: relative;
      display: flex;
      align-items: center;
    }

    .user-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border: none;
      background: linear-gradient(135deg, var(--primary) 0%, #d46a99 100%);
      color: white;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9em;

    .nav-btn-admin {
      position: relative;
      background: linear-gradient(135deg, #20B997 0%, #0B5345 100%);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 24px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(32, 185, 151, 0.3);
    }

    .nav-btn-admin:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(32, 185, 151, 0.4);
    }

    .pedidos-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: linear-gradient(135deg, #ff3b30 0%, #ff1744 100%);
      color: white;
      font-size: 10px;
      font-weight: 700;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid white;
      box-shadow: 0 3px 10px rgba(255, 59, 48, 0.4);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 3px 10px rgba(255, 59, 48, 0.4);
      }
      50% {
        box-shadow: 0 3px 15px rgba(255, 59, 48, 0.7);
      }
    }
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(199, 65, 123, 0.3);
    }

    .user-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(199, 65, 123, 0.4);
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      font-weight: 700;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      min-width: 280px;
      margin-top: 10px;
      display: none;
      z-index: 1001;
      overflow: hidden;
    }

    .dropdown-menu.activo {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .dropdown-header {
      background: linear-gradient(135deg, var(--primary) 0%, #d46a99 100%);
      color: white;
      padding: 20px;
      text-align: center;
    }

    .dropdown-user-name {
      font-size: 1.1em;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .dropdown-user-email {
      font-size: 0.85em;
      opacity: 0.9;
      word-break: break-all;
    }

    .dropdown-body {
      padding: 10px 0;
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      color: var(--text);
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.95em;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-family: 'Poppins', sans-serif;
      font-weight: 500;
    }

    .dropdown-item:hover {
      background: var(--light-bg);
      color: var(--primary);
      padding-left: 24px;
    }

    .dropdown-item i {
      width: 20px;
      text-align: center;
      color: var(--primary);
    }

    .dropdown-item:hover i {
      transform: scale(1.2);
    }

    .dropdown-divider {
      height: 1px;
      background: var(--border);
      margin: 8px 0;
    }

    .dropdown-item-logout {
      color: #ff6b6b;
    }

    .dropdown-item-logout:hover {
      background: #fff5f5;
    }

    .dropdown-item-logout i {
      color: #ff6b6b;
    }

    .hero {
      background: linear-gradient(135deg, var(--primary) 0%, #d46a99 100%);
      color: white;
      padding: 60px 40px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      border-radius: 50%;
    }

    .hero h1 {
      font-size: 20px;
      margin-bottom: 15px;
      font-weight: 800;
      letter-spacing: -1px;
      position: relative;
      z-index: 1;
    }

    .hero p {
      font-size: 1.1em;
      opacity: 0.95;
      position: relative;
      z-index: 1;
      font-weight: 300;
    }

    .container {
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
      padding: 30px 40px;
      display: block;
      box-sizing: border-box;
    }

    .sidebar-filtros {
      background: white;
      padding: 20px 16px;
      border-radius: 18px;
      box-shadow: 0 4px 15px rgba(32, 185, 151, 0.1);
      height: fit-content;
      max-height: calc(100vh - 140px);
      position: sticky;
      top: 120px;
      border: 1px solid rgba(32, 185, 151, 0.15);
      backdrop-filter: blur(10px);
      width: 100%;
      overflow-y: auto;
    }

    .sidebar-filtros h3 {
      font-size: 0.9em;
      color: var(--secondary);
      margin-bottom: 15px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 6px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .sidebar-filtros h3 i {
      color: var(--primary);
      font-size: 1.2em;
    }

    #marcasList {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      overflow: visible;
    }

    .marca-filtro {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 9px 10px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--light-bg) 0%, #e8f5f3 100%);
      color: var(--text);
      text-decoration: none;
      cursor: pointer;
      transition: all 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
      border: 2px solid transparent;
      font-size: 0.8em;
      font-weight: 600;
      text-align: left;
      position: relative;
      overflow: visible;
      white-space: normal;
      word-wrap: break-word;
    }

    .marca-filtro::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }

    .marca-filtro:hover::before {
      left: 100%;
    }

    .marca-filtro:hover {
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
      color: white;
      border-color: var(--primary);
      transform: translateX(8px);
      box-shadow: 0 6px 20px rgba(32, 185, 151, 0.25);
    }

    .marca-filtro.active {
      background: linear-gradient(135deg, var(--primary) 0%, #0f9f7f 100%);
      color: white;
      border-color: var(--primary);
      font-weight: 800;
      box-shadow: 0 8px 28px rgba(32, 185, 151, 0.35);
      transform: scale(1.02);
    }

    .marca-filtro.active::after {
      content: 'âœ“';
      font-size: 1.2em;
      font-weight: bold;
    }

    .main-content {
      display: flex;
      flex-direction: column;
      gap: 30px;
      width: 100%;
      max-width: 100%;
      overflow: visible;
    }
    

    /* Carrusel Destacados */
    .carousel-section {
      position: relative;
      width: 100%;
      max-width: 100%;
      margin-bottom: 30px;
      padding: 0;
    }

    .carousel-container {
      position: relative;
      width: 100%;
      height: 280px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(32, 185, 151, 0.15);
      background: linear-gradient(135deg, var(--accent), #E0F8F5);
    }

    .carousel-track {
      display: flex;
      height: 100%;
      transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .carousel-slide {
      min-width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0;
      position: relative;
      gap: 0;
      background-size: cover;
      background-position: center right;
    }

    .carousel-slide.banner {
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      background-color: #F1F8F6;
    }

    .carousel-slide.banner .carousel-img {
      display: none;
    }

    .carousel-slide.banner .carousel-content {
      flex: 0 0 55%;
      background: rgba(255, 255, 255, 0.88);
    }

    .carousel-slide::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(32, 185, 151, 0.3) 0%, rgba(32, 185, 151, 0.1) 50%, transparent 100%);
      pointer-events: none;
    }

    .carousel-content {
      flex: 0 0 50%;
      z-index: 2;
      display: flex;
      flex-direction: column;
      gap: 15px;
      padding: 40px;
      background: rgba(255, 255, 255, 0.95);
      height: 100%;
      justify-content: center;
      box-shadow: inset -20px 0 40px rgba(0, 0, 0, 0.05);
    }

    .carousel-content h2 {
      font-size: 2em;
      font-weight: 800;
      color: var(--secondary);
      letter-spacing: -1px;
      line-height: 1.2;
      margin: 0;
    }

    .carousel-content p {
      font-size: 0.95em;
      color: #0B5345;
      line-height: 1.6;
      margin: 0;
    }

    .carousel-price {
      font-size: 1.8em;
      font-weight: 800;
      color: var(--primary);
      margin: 10px 0 5px 0;
    }

    .carousel-content .btn-comprar {
      margin-top: 10px;
      width: fit-content;
    }

    .carousel-img {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
      height: 100%;
      padding: 20px;
    }

    .carousel-img img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.2));
    }

    .carousel-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 3;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.3em;
      color: var(--primary);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .carousel-nav:hover {
      background: white;
      transform: translateY(-50%) scale(1.1);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .carousel-nav-prev {
      left: 20px;
    }

    .carousel-nav-next {
      right: 20px;
    }

    .carousel-dots {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 3;
    }

    .carousel-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.6);
      border: 2px solid white;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .carousel-dot.active {
      background: white;
      width: 30px;
      border-radius: 6px;
    }

    .carousel-dot:hover {
      background: rgba(255, 255, 255, 0.9);
    }

    .filtro-seccion {
      background: white;
      padding: 20px 25px;
      border-radius: 18px;
      box-shadow: 0 4px 15px rgba(32, 185, 151, 0.08);
      text-align: left;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 20px;
      justify-content: flex-start;
      width: 100%;
      max-width: 100%;
      border: 1px solid rgba(32, 185, 151, 0.15);
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    .filtro-seccion:hover {
      box-shadow: var(--shadow);
    }

    .filtro-seccion h2 {
      font-size: 1.05em;
      margin: 0;
      color: var(--primary);
      font-weight: 700;
      letter-spacing: 0.3px;
      min-width: 130px;
    }

    .btn-filtro {
      padding: 9px 16px;
      margin: 0;
      border: 2px solid transparent;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85em;
      transition: all 0.3s ease;
      background: #f5f5f5;
      color: var(--text);
    }

    .btn-filtro:hover {
      background: var(--accent);
      border-color: var(--primary);
    }

    .btn-filtro.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .dropdown-container {
      display: inline-block;
      position: relative;
    }

    .dropdown-marcas {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: var(--shadow);
      display: none;
      z-index: 1000;
      min-width: 200px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 8px;
    }

    .dropdown-marcas.activo {
      display: block;
      animation: dropdownSlide 0.3s ease;
    }

    @keyframes dropdownSlide {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .dropdown-marcas a {
      display: block;
      padding: 12px 16px;
      color: var(--text);
      text-decoration: none;
      font-weight: 500;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      font-size: 0.88em;
      transition: all 0.2s ease;
    }

    .dropdown-marcas a:last-child {
      border-bottom: none;
    }

    .dropdown-marcas a:hover {
      background: var(--accent);
      color: var(--primary);
      padding-left: 20px;
    }

    .dropdown-marcas a.selected {
      background: linear-gradient(135deg, var(--primary) 0%, #17a085 100%);
      color: white;
      font-weight: 600;
    }

    .dropdown-marcas::-webkit-scrollbar {
      width: 6px;
    }

    .dropdown-marcas::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }

    .dropdown-marcas::-webkit-scrollbar-track {
      background: #f5f5f5;
    }

    .genero-dropdown-wrapper {
      position: relative;
      display: inline-block;
    }

    .section-title {
      font-size: 2em;
      margin-bottom: 40px;
      color: var(--text);
      text-align: center;
      font-weight: 800;
      letter-spacing: -0.5px;
    }

    .productos-grid {
      display: grid !important;
      grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
      gap: 20px;
      margin-bottom: 60px;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      padding: 10px 0;
      align-items: start;
    }
    

    .producto-card {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(32, 185, 151, 0.1);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 1px solid rgba(32, 185, 151, 0.15);
      position: relative;
      cursor: pointer;
      width: 100%;
      max-width: 100%;
      height: 380px;
      display: flex;
      flex-direction: column;
    }

    .producto-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(32, 185, 151, 0) 0%, rgba(32, 185, 151, 0.08) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1;
      pointer-events: none;
    }

    .producto-card:hover {
      transform: translateY(-12px);
      box-shadow: 0 12px 30px rgba(32, 185, 151, 0.2);
      border-color: var(--primary);
    }

    .producto-card:hover::before {
      opacity: 1;
    }

    .producto-card-img {
      width: 100%;
      height: 200px;
      background: linear-gradient(135deg, #f9fffe 0%, #e8f5f3 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
      flex-shrink: 0;
    }

    .producto-card-img img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: transform 0.4s ease;
      padding: 15px;
    }

    .producto-card:hover .producto-card-img img {
      transform: scale(1.08);
    }

    .producto-info {
      padding: 16px 14px 14px 14px;
      position: relative;
      z-index: 2;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .producto-card h3 {
      margin: 0 0 6px 0;
      font-size: 0.9em;
      color: var(--text);
      line-height: 1.3;
      height: 2.6em;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      font-weight: 700;
    }

    .producto-card p {
      font-size: 0.8em;
      color: var(--primary);
      margin: 0 0 8px 0;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .product-price-section {
      display: flex;
      align-items: center;
      gap: 4px;
      margin: 10px 0 0 0;
    }

    .producto-card .product-price {
      font-size: 1.3em;
      font-weight: 800;
      color: var(--primary);
    }

    .btn-comprar {
      width: 100%;
      padding: 11px 14px;
      background: linear-gradient(135deg, var(--primary) 0%, #d46a99 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 0.8em;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(32, 185, 151, 0.3);
      margin-top: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-comprar:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(32, 185, 151, 0.4);
    }

    .stock-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 0.75em;
      font-weight: 700;
      margin-top: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
    }

    .stock-in {
      background: linear-gradient(135deg, var(--primary) 0%, #0f9f7f 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(32, 185, 151, 0.3);
      border: none;
    }

    .stock-in::before {
      content: 'âœ“';
      font-weight: 800;
      font-size: 1.1em;
    }

    .stock-out {
      background: linear-gradient(135deg, #ff6b6b 0%, #ff1744 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
      border: none;
    }

    .stock-out::before {
      content: '!'; 
      font-weight: 800;
      font-size: 1.1em;
    }

    .btn-comprar:active {
      transform: translateY(0);
    }

    .rating {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      margin: 8px 0 6px 0;
    }

    .star {
      cursor: pointer;
      font-size: 12px;
      color: #ddd;
      transition: color 0.2s ease;
      user-select: none;
    }

    .star.filled {
      color: #ffc107;
    }

    .rating-label {
      color: #999;
      font-size: 0.72em;
      font-weight: 500;
      margin-left: 3px;
    }

    .star.disabled {
      cursor: default;
    }

    .comentarios-section {
      margin-top: 10px;
      border-top: 1px solid var(--border);
      padding-top: 8px;
    }

    .comentario-form {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 8px;
    }

    .comentario-form textarea {
      width: 100%;
      padding: 6px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-family: 'Poppins', sans-serif;
      font-size: 0.75em;
      resize: vertical;
      min-height: 40px;
      background: white;
    }

    .comentario-form button {
      padding: 6px 12px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.75em;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .comentario-form button:hover {
      background: var(--secondary);
      transform: translateY(-2px);
    }

    .comentarios-lista {
      margin-top: 6px;
      max-height: 120px;
      overflow-y: auto;
    }

    .comentario-item {
      background: var(--light-bg);
      padding: 6px;
      margin-bottom: 4px;
      border-radius: 6px;
      font-size: 0.7em;
      border-left: 2px solid var(--primary);
    }

    .comentario-usuario {
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 2px;
    }

    .comentario-texto {
      color: var(--text);
      word-wrap: break-word;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .categoria-titulo {
      font-size: 1.4em;
      font-weight: 800;
      margin: 40px 0 20px 0;
      color: var(--primary);
      padding-bottom: 12px;
      border-bottom: 3px solid var(--primary);
    }

    .footer {
      background: var(--secondary);
      color: white;
      padding: 50px 40px 30px;
      text-align: center;
      margin-top: 80px;
      border-top: 3px solid var(--primary);
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .footer-links a {
      color: #ddd;
      text-decoration: none;
      font-size: 0.95em;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .footer-links a:hover {
      color: var(--primary-light);
    }

    .footer p {
      color: #aaa;
      font-size: 0.9em;
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }

      .sidebar-filtros {
        position: static;
        top: auto;
        margin-bottom: 20px;
      }

      .navbar {
        padding: 15px 20px;
      }

      .logo {
        font-size: 1.5em;
      }

      .hero {
        padding: 40px 20px;
      }

      .hero h1 {
        font-size: 2.2em;
      }

      .carousel-container {
        height: 280px;
      }

      .carousel-slide {
        flex-direction: column;
        padding: 0;
        gap: 0;
      }

      .carousel-content {
        flex: 1;
        height: auto;
        padding: 25px;
        background: rgba(255, 255, 255, 0.98);
        box-shadow: inset 0 -20px 40px rgba(0, 0, 0, 0.05);
      }

      .carousel-content h2 {
        font-size: 1.4em;
      }

      .carousel-content p {
        font-size: 0.85em;
      }

      .carousel-price {
        font-size: 1.3em;
      }

      .carousel-img {
        height: 150px;
      }

      .carousel-img img {
        max-height: 150px;
      }

      .carousel-nav {
        width: 40px;
        height: 40px;
        font-size: 1em;
      }

      .carousel-nav-prev {
        left: 10px;
      }

      .carousel-nav-next {
        right: 10px;
      }

      .container {
        padding: 30px 20px;
      }

      .filtro-seccion {
        padding: 15px;
        gap: 10px;
      }

      .filtro-seccion h2 {
        font-size: 0.95em;
      }

      .productos-grid {
        grid-template-columns: repeat(4, 1fr) !important;
        gap: 15px;
      }

      .producto-card-img {
        height: 240px;
      }

      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(400px);
          opacity: 0;
        }
      }

      .footer {
        padding: 40px 20px 20px;
      }

      .footer-links {
        gap: 15px;
      }
    }
  </style>
  <script src="config.js"></script>
  </head>
  <body>
  <div class="page">
  <div class="page-content">

<!-- Navbar -->
<div class="navbar">
  <div class="navbar-left">
    <div class="logo" onclick="window.location.href='welcome.html'">âœ¨ SofiShop</div>
    <a href="perfumes.html" class="nav-link">ðŸŒ¸ Perfumes</a>
    <div class="genero-dropdown-wrapper">
      <button id="btn-hombre" class="nav-link" style="background: none; border: none; cursor: pointer; font-size: 0.95em; font-weight: 600; display: flex; align-items: center; gap: 6px;" onclick="toggleDropdownHombre(event)">
        <i class="fas fa-male"></i> Hombre <i class="fas fa-chevron-down" style="font-size: 0.75em;"></i>
      </button>
      <div class="dropdown-marcas" id="dropdown-hombre"></div>
    </div>
    <div class="genero-dropdown-wrapper">
      <button id="btn-mujer" class="nav-link" style="background: none; border: none; cursor: pointer; font-size: 0.95em; font-weight: 600; display: flex; align-items: center; gap: 6px;" onclick="toggleDropdownMujer(event)">
        <i class="fas fa-female"></i> Mujer <i class="fas fa-chevron-down" style="font-size: 0.75em;"></i>
      </button>
      <div class="dropdown-marcas" id="dropdown-mujer"></div>
    </div>
    <div class="search-box" style="display: flex; align-items: center; gap: 8px; background: var(--light-bg); padding: 8px 12px; border-radius: 25px; margin-left: 10px;">
      <i class="fas fa-search" style="color: var(--primary); font-size: 0.9em;"></i>
      <input type="text" id="search-input" placeholder="Buscar productos..." style="background: none; border: none; outline: none; font-size: 0.9em; color: var(--text); width: 200px; font-family: 'Poppins', sans-serif;" onkeyup="realizarBusqueda()" />
    </div>
  </div>
  <div class="navbar-right">
    <button class="nav-btn nav-btn-cart" onclick="window.location.href='cart.html'">
      <img src="imagen/iconocarrito.png" alt="Carrito" style="width: 28px; height: 28px; display: block;">
    </button>
    <button class="nav-btn nav-btn-admin" id="admin-btn" onclick="window.location.href='add-product.html'">
      <i class="fas fa-plus"></i> Agregar
    </button>
    <button class="nav-btn nav-btn-admin" id="pedidos-btn" onclick="window.location.href='admin-pedidos.html'" style="display:none;">
      <i class="fas fa-boxes"></i> Pedidos
      <span class="pedidos-badge" id="pedidos-count" style="display:none;">0</span>
    </button>
    <button class="nav-btn nav-btn-admin" id="inventario-btn" onclick="window.location.href='admin-inventario.html'" style="display:none;">
      <i class="fas fa-warehouse"></i> Inventario
    </button>

    <!-- NOTIFICACIONES -->
    <div class="notif-menu" id="notif-usuario">
      <button class="nav-btn-notif" onclick="toggleNotificaciones()">
        <i class="fas fa-bell"></i>
        <span class="notif-badge" id="notif-count" style="display:none;">0</span>
      </button>

      <div class="notif-dropdown" id="notif-dropdown">
        <div class="notif-header">
          <h3>Notificaciones</h3>
          <button class="btn-marcar-leidas" onclick="marcarTodasLeidas()">Marcar todas como leÃ­das</button>
        </div>
        <div class="notif-lista" id="notif-lista">
          <div class="notif-vacia">No tienes notificaciones</div>
        </div>
      </div>
    </div>

    <div class="user-menu">
      <button class="user-btn" onclick="toggleDropdown()">
        <div class="user-avatar" id="avatar-btn">ðŸ‘¤</div>
        <span id="nombre-btn">Usuario</span>
        <i class="fas fa-chevron-down" style="font-size: 0.8em;"></i>
      </button>

      <div class="dropdown-menu" id="dropdown-menu">
        <div class="dropdown-header">
          <div class="dropdown-user-name" id="dropdown-nombre">Usuario</div>
          <div class="dropdown-user-email" id="dropdown-email">usuario@email.com</div>
        </div>

        <div class="dropdown-body">
          <button class="dropdown-item" onclick="irA('profile.html')">
            <i class="fas fa-user-circle"></i>
            <span>Mi Perfil</span>
          </button>
          <button class="dropdown-item" onclick="irA('profile.html')">
            <i class="fas fa-shopping-bag"></i>
            <span>Mis Pedidos</span>
          </button>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item" onclick="irA('profile.html')">
            <i class="fas fa-cog"></i>
            <span>ConfiguraciÃ³n</span>
          </button>
          <button class="dropdown-item" onclick="irA('welcome.html')">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
          </button>
          <button class="dropdown-item" id="inventario-dropdown-perfumes" onclick="irA('admin-inventario.html')" style="display: none;">
            <i class="fas fa-boxes"></i>
            <span>Inventario</span>
          </button>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item dropdown-item-logout" onclick="logoutFromDropdown()">
            <i class="fas fa-sign-out-alt"></i>
            <span>Cerrar SesiÃ³n</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Hero -->
<div class="hero">
  <h1>ðŸŒ¸ Fragancias Exclusivas</h1>
  <p>Descubre nuestras mejores perfumes seleccionados para ti</p>
</div>

<!-- Container -->
<div class="container">

  <!-- Main Content -->
  <div class="main-content">
    <!-- Carrusel Destacados -->
    <div class="carousel-section">
      <h2 style="margin-bottom: 20px; font-size: 1.5em; color: var(--text); text-align: center;"><i class="fas fa-star"></i> Nuestros Favoritos</h2>
      <div class="carousel-container">
        <div class="carousel-track" id="carouselTrack">
          <!-- Los slides se generan con JavaScript -->
        </div>
        <button class="carousel-nav carousel-nav-prev" onclick="prevSlide()">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="carousel-nav carousel-nav-next" onclick="nextSlide()">
          <i class="fas fa-chevron-right"></i>
        </button>
        <div class="carousel-dots" id="carouselDots">
          <!-- Los dots se generan con JavaScript -->
        </div>
      </div>
    </div>

  <!-- Productos -->
  <div id="estado-carga" style="margin: 6px 0 12px; font-size: 0.9em; color: #5a6; font-weight: 600;"></div>
  <div id="productos" class="productos-grid"></div>
  </div><!-- Cierra main-content -->
</div><!-- Cierra container -->

<!-- Modal de EdiciÃ³n de Producto -->
<div id="modal-editar-producto" class="modal" style="display: none;">
  <div class="modal-content" style="max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--primary);">
      <h2 style="margin: 0; color: var(--primary); font-size: 1.5em;">
        <i class="fas fa-edit"></i> Editar Producto
      </h2>
      <button onclick="cerrarModalEditar()" style="background: none; border: none; font-size: 1.5em; color: #999; cursor: pointer; padding: 0; width: 30px; height: 30px;">&times;</button>
    </div>
    
    <form id="form-editar-producto" onsubmit="guardarEdicionProducto(event)" enctype="multipart/form-data" style="display: flex; flex-direction: column; gap: 15px;">
      <input type="hidden" id="edit-producto-id">
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text);">Nombre del Producto</label>
        <input type="text" id="edit-nombre" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em;">
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text);">Precio</label>
        <input type="number" id="edit-precio" step="0.01" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em;">
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text);">Marca</label>
        <input type="text" id="edit-marca" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em;">
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text);">CategorÃ­a</label>
        <select id="edit-categoria" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em;">
          <option value="perfumes">Perfumes</option>
          <option value="colonias">Colonias</option>
          <option value="fragancias">Fragancias</option>
        </select>
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text);">SubcategorÃ­a (GÃ©nero)</label>
        <select id="edit-subcategoria" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em;">
          <option value="hombre">Hombre</option>
          <option value="mujer">Mujer</option>
        </select>
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text);">Stock</label>
        <input type="number" id="edit-stock" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em;">
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text);">DescripciÃ³n</label>
        <textarea id="edit-descripcion" rows="3" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em; resize: vertical;"></textarea>
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text);">Imagen</label>
        <input type="file" id="edit-imagen" accept="image/*" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.95em; background: white;">
        <small style="color: #999; font-size: 0.85em;">Sube una imagen nueva si deseas reemplazarla</small>
      </div>
      
      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button type="submit" style="flex: 1; padding: 12px; background: linear-gradient(135deg, var(--primary) 0%, #17a085 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1em;">
          <i class="fas fa-save"></i> Guardar Cambios
        </button>
        <button type="button" onclick="cerrarModalEditar()" style="flex: 1; padding: 12px; background: #f5f5f5; color: var(--text); border: 1px solid var(--border); border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1em;">
          <i class="fas fa-times"></i> Cancelar
        </button>
      </div>
    </form>
  </div>
</div>



<script src="audit.js"></script>
<script>
  let todosLosProductos = [];
  let generoSeleccionado = 'hombre';
  let marcaSeleccionada = null;
  let palabraBusqueda = '';

  // permitir ver productos incluso sin login
  let usuario = null;
  try {
    usuario = JSON.parse(localStorage.getItem('usuario'));
  } catch (e) {
    usuario = null;
  }
  // No sobrescribir el localStorage, solo usar valor por defecto para la variable
  if (!usuario) {
    usuario = { nombre: 'Invitado', email: '', rol: 'invitado' };
  }

  // Mostrar botÃ³n de admin si el usuario es administrador
  const cartBtn = document.querySelector('.nav-btn-cart');
  if (usuario && usuario.rol === 'admin') {
    document.getElementById('admin-btn').style.display = 'inline-block';
    document.getElementById('pedidos-btn').style.display = 'inline-block';
    document.getElementById('inventario-btn').style.display = 'inline-block';
    if (cartBtn) cartBtn.style.display = 'none';
    const inventarioDropdown = document.getElementById('inventario-dropdown-perfumes');
    if (inventarioDropdown) {
      inventarioDropdown.style.display = 'block';
    }
    actualizarPedidosPendientes();
  }

  async function actualizarPedidosPendientes() {
    const badge = document.getElementById('pedidos-count');
    if (!badge) return;
    try {
      const response = await fetch(API_URL + '/api/orders');
      if (!response.ok) throw new Error('Respuesta invÃ¡lida del servidor');
      const pedidos = await response.json();
      const pendientes = pedidos.filter(p => (p.estado || '').toLowerCase() === 'pendiente').length;
      if (pendientes > 0) {
        badge.textContent = pendientes;
        badge.style.display = 'inline-flex';
      } else {
        badge.style.display = 'none';
      }
    } catch (error) {
      badge.style.display = 'none';
    }
  }
  
  // Actualizar badge cuando el DOM estÃ¡ listo
  document.addEventListener('DOMContentLoaded', () => {
    try {
      actualizarPedidosPendientes();
      setInterval(actualizarPedidosPendientes, 5000);
    } catch (e) {}
  });

  if (usuario && window.AuditLogger) {
    AuditLogger.log('VisitÃ³ la pÃ¡gina de perfumes');
  }

  // Revisar si hay un parÃ¡metro de gÃ©nero en la URL
  const urlParams = new URLSearchParams(window.location.search);
  const generoURL = urlParams.get('genero');
  const searchParam = urlParams.get('search');
  if (generoURL && (generoURL === 'hombre' || generoURL === 'mujer')) {
    generoSeleccionado = generoURL;
  }
  if (searchParam) {
    palabraBusqueda = searchParam.toLowerCase();
  }

  // Esperar a que el DOM estÃ© listo antes de inicializar
  document.addEventListener('DOMContentLoaded', () => {
    // Inicializar menu de usuario
    inicializarMenuUsuario();
    
    // Inicializar marcas y etiqueta de gÃ©nero
    actualizarListaMarcas();
    setGeneroTag();
    
    // cargar productos de perfumes
    fetch(API_URL + '/api/products?categoria=perfumes&t=' + Date.now())
      .then(res => res.json())
      .then(async data => {
        let productos = Array.isArray(data) ? data : [];
        if (productos.length === 0) {
          try {
            const resAll = await fetch(API_URL + '/api/products?t=' + Date.now());
            const dataAll = await resAll.json();
            if (Array.isArray(dataAll)) productos = dataAll;
          } catch (e) {
            // ignore fallback error
          }
        }

        todosLosProductos = productos;
        const estado = document.getElementById('estado-carga');
        if (estado) {
          estado.textContent = `Productos cargados: ${todosLosProductos.length}`;
          estado.style.color = todosLosProductos.length > 0 ? '#2a9d8f' : '#c0392b';
        }
        verificarNuevosProductos(todosLosProductos);
        setGeneroTag();
        mostrarProductos();
        actualizarListaMarcas();
        inicializarCarrusel(); // Inicializar carrusel con los productos
      })
      .catch(err => {
        const div = document.getElementById('productos');
        const estado = document.getElementById('estado-carga');
        if (estado) {
          estado.textContent = `Error al cargar productos: ${err.message}`;
          estado.style.color = '#c0392b';
        }
        if (div) {
          div.innerHTML = `<div style=\"grid-column: 1/-1; padding: 40px; text-align: center; color: red;\">Error al cargar productos: ${err.message}</div>`;
        }
      });
  });

  function verificarNuevosProductos(productosActuales) {
    const usuario = JSON.parse(localStorage.getItem('usuario'));
    if (!usuario || usuario.rol === 'admin') return;
    
    const productosAnteriores = JSON.parse(localStorage.getItem('productosConocidos')) || [];
    const idsAnteriores = productosAnteriores.map(p => p._id);
    const productosNuevos = productosActuales.filter(p => !idsAnteriores.includes(p._id));
    
    if (productosNuevos.length > 0 && productosAnteriores.length > 0) {
      const mensaje = `ðŸŽ‰ Â¡${productosNuevos.length} nuevo${productosNuevos.length > 1 ? 's' : ''} producto${productosNuevos.length > 1 ? 's' : ''} disponible${productosNuevos.length > 1 ? 's' : ''}!`;
      agregarNotificacion(mensaje, 'productos');
      mostrarNotificacion(mensaje);
    }
    
    localStorage.setItem('productosConocidos', JSON.stringify(productosActuales.map(p => ({ _id: p._id, nombre: p.nombre }))));
  }

  function agregarNotificacion(mensaje, tipo = 'info') {
    const notificaciones = JSON.parse(localStorage.getItem('notificaciones')) || [];
    const nuevaNotif = {
      id: Date.now(),
      mensaje: mensaje,
      tipo: tipo,
      fecha: new Date().toISOString(),
      leida: false
    };
    notificaciones.unshift(nuevaNotif);
    localStorage.setItem('notificaciones', JSON.stringify(notificaciones.slice(0, 50)));
    actualizarContadorNotificaciones();
  }

  function mostrarNotificacion(mensaje) {
    const notif = document.createElement('div');
    notif.style.cssText = `
      position: fixed;
      top: 80px;
      right: 20px;
      background: linear-gradient(135deg, var(--primary) 0%, #d46a99 100%);
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(32, 185, 151, 0.4);
      z-index: 10000;
      font-weight: 600;
      animation: slideIn 0.4s ease;
      max-width: 300px;
    `;
    notif.textContent = mensaje;
    document.body.appendChild(notif);
    
    setTimeout(() => {
      notif.style.animation = 'slideOut 0.4s ease';
      setTimeout(() => notif.remove(), 400);
    }, 4000);
  }

  function setGeneroTag() {
    const btnHombre = document.getElementById('btn-hombre');
    const btnMujer = document.getElementById('btn-mujer');
    
    // Marcar activo si es el gÃ©nero seleccionado
    if (generoSeleccionado === 'hombre') {
      btnHombre.classList.add('active');
      btnMujer.classList.remove('active');
    } else if (generoSeleccionado === 'mujer') {
      btnMujer.classList.add('active');
      btnHombre.classList.remove('active');
    }
  }

  function toggleDropdown() {
    const dropdown = document.getElementById('dropdownMarcas');
    dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
  }

  function toggleDropdownHombre(event) {
    event.stopPropagation();
    const dropdown = document.getElementById('dropdown-hombre');
    const dropdownMujer = document.getElementById('dropdown-mujer');
    const isActive = dropdown.classList.contains('activo');
    
    // Cerrar dropdown de mujer si estÃ¡ abierto
    if (dropdownMujer) dropdownMujer.classList.remove('activo');
    
    if (isActive) {
      dropdown.classList.remove('activo');
    } else {
      // Cambiar a gÃ©nero hombre
      generoSeleccionado = 'hombre';
      setGeneroTag();
      actualizarListaMarcas();
      mostrarProductos();
      inicializarCarrusel();
      
      // Cargar marcas de hombre en el dropdown
      cargarMarcasDropdownHombre();
      dropdown.classList.add('activo');
    }
  }

  function toggleDropdownMujer(event) {
    event.stopPropagation();
    const dropdown = document.getElementById('dropdown-mujer');
    const dropdownHombre = document.getElementById('dropdown-hombre');
    const isActive = dropdown.classList.contains('activo');
    
    // Cerrar dropdown de hombre si estÃ¡ abierto
    if (dropdownHombre) dropdownHombre.classList.remove('activo');
    
    if (isActive) {
      dropdown.classList.remove('activo');
    } else {
      // Cambiar a gÃ©nero mujer
      generoSeleccionado = 'mujer';
      setGeneroTag();
      actualizarListaMarcas();
      mostrarProductos();
      inicializarCarrusel();
      
      // Cargar marcas de mujer en el dropdown
      cargarMarcasDropdownMujer();
      dropdown.classList.add('activo');
    }
  }

  function cargarMarcasDropdownHombre() {
    const dropdown = document.getElementById('dropdown-hombre');
    if (!dropdown) return;
    
    // Marcas de hombre predefinidas
    const marcasHombre = ['Bharara', 'Calvin Klein', 'Carolina Herrera', 'Gucci', 'Hugo Boss', 'Lattafa', 'Paco Rabanne', 'Paris Hilton', 'Ralph Lauren'];
    
    // Si hay productos cargados, obtener marcas dinÃ¡micamente
    if (todosLosProductos.length > 0) {
      const marcasDinamicas = [...new Set(
        todosLosProductos
          .filter(p => (p.subcategoria || '').toLowerCase().trim() === 'hombre')
          .map(p => p.marca)
          .filter(m => m)
      )].sort();
      
      if (marcasDinamicas.length > 0) {
        // Usar marcas dinÃ¡micas si existen
        dropdown.innerHTML = '';
        marcasDinamicas.forEach(marca => {
          const link = document.createElement('a');
          link.textContent = marca;
          link.onclick = (e) => {
            e.preventDefault();
            filtrarPorMarcaDesdeDropdown(marca);
          };
          if (marcaSeleccionada === marca) {
            link.classList.add('selected');
          }
          dropdown.appendChild(link);
        });
        return;
      }
    }
    
    // Usar marcas predefinidas como fallback
    dropdown.innerHTML = '';
    marcasHombre.forEach(marca => {
      const link = document.createElement('a');
      link.textContent = marca;
      link.onclick = (e) => {
        e.preventDefault();
        filtrarPorMarcaDesdeDropdown(marca);
      };
      if (marcaSeleccionada === marca) {
        link.classList.add('selected');
      }
      dropdown.appendChild(link);
    });
  }

  function filtrarPorMarcaDesdeDropdown(marca) {
    marcaSeleccionada = marca;
    generoSeleccionado = 'hombre';
    palabraBusqueda = '';
    
    // Cerrar dropdown
    const dropdown = document.getElementById('dropdown-hombre');
    if (dropdown) {
      dropdown.classList.remove('activo');
    }
    
    setGeneroTag();
    actualizarListaMarcas();
    mostrarProductos();
    inicializarCarrusel();
    
    // Scroll suave a productos
    const productosDiv = document.getElementById('productos');
    if (productosDiv) {
      productosDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }

  function filtrarPorMarcaDesdeDropdownMujer(marca) {
    marcaSeleccionada = marca;
    generoSeleccionado = 'mujer';
    palabraBusqueda = '';
    
    // Cerrar dropdown
    const dropdown = document.getElementById('dropdown-mujer');
    if (dropdown) {
      dropdown.classList.remove('activo');
    }
    
    setGeneroTag();
    actualizarListaMarcas();
    mostrarProductos();
    inicializarCarrusel();
    
    // Scroll suave a productos
    const productosDiv = document.getElementById('productos');
    if (productosDiv) {
      productosDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }

  function cargarMarcasDropdownMujer() {
    const dropdown = document.getElementById('dropdown-mujer');
    if (!dropdown) return;
    
    // Marcas de mujer predefinidas
    const marcasMujer = ['Afnan', 'Ariana Grande', 'Britney Spears', 'Calvin Klein', 'Carolina Herrera', 'Hugo Boss', 'Kathy Perry', 'Paco Rabanne', 'Paris Hilton'];
    
    // Si hay productos cargados, obtener marcas dinÃ¡micamente
    if (todosLosProductos.length > 0) {
      const marcasDinamicas = [...new Set(
        todosLosProductos
          .filter(p => (p.subcategoria || '').toLowerCase().trim() === 'mujer')
          .map(p => p.marca)
          .filter(m => m)
      )].sort();
      
      if (marcasDinamicas.length > 0) {
        // Usar marcas dinÃ¡micas si existen
        dropdown.innerHTML = '';
        marcasDinamicas.forEach(marca => {
          const link = document.createElement('a');
          link.textContent = marca;
          link.onclick = (e) => {
            e.preventDefault();
            filtrarPorMarcaDesdeDropdownMujer(marca);
          };
          if (marcaSeleccionada === marca) {
            link.classList.add('selected');
          }
          dropdown.appendChild(link);
        });
        return;
      }
    }
    
    // Usar marcas predefinidas como fallback
    dropdown.innerHTML = '';
    marcasMujer.forEach(marca => {
      const link = document.createElement('a');
      link.textContent = marca;
      link.onclick = (e) => {
        e.preventDefault();
        filtrarPorMarcaDesdeDropdownMujer(marca);
      };
      if (marcaSeleccionada === marca) {
        link.classList.add('selected');
      }
      dropdown.appendChild(link);
    });
  }

  function filtrarGenero(genero) {
    generoSeleccionado = genero;
    marcaSeleccionada = null;
    palabraBusqueda = '';
    setGeneroTag();
    actualizarListaMarcas();
    mostrarProductos();
    inicializarCarrusel(); // Actualizar carrusel con productos del gÃ©nero seleccionado
  }

  // Cerrar dropdown al hacer clic fuera
  document.addEventListener('click', function(event) {
    const dropdownHombre = document.getElementById('dropdown-hombre');
    const btnHombre = document.getElementById('btn-hombre');
    const dropdownMujer = document.getElementById('dropdown-mujer');
    const btnMujer = document.getElementById('btn-mujer');
    
    if (dropdownHombre && !dropdownHombre.contains(event.target) && !btnHombre.contains(event.target)) {
      dropdownHombre.classList.remove('activo');
    }
    
    if (dropdownMujer && !dropdownMujer.contains(event.target) && !btnMujer.contains(event.target)) {
      dropdownMujer.classList.remove('activo');
    }
  });

  function filtrarPorMarca(marca) {
    marcaSeleccionada = marca;
    palabraBusqueda = '';
    setGeneroTag();
    actualizarListaMarcas();
    mostrarProductos();
  }

  function actualizarListaMarcas() {
    const marcasList = document.getElementById('marcasList');
    if (!marcasList) return;
    marcasList.innerHTML = '';
    
    const generoNormalizado = (generoSeleccionado || '').toLowerCase().trim();
    let marcas = [];
    
    if (generoNormalizado === 'mujer') {
      // Marcas para mujer (9 marcas)
      marcas = ['Afnan', 'Ariana Grande', 'Britney Spears', 'Calvin Klein', 'Carolina Herrera', 'Hugo Boss', 'Kathy Perry', 'Paco Rabanne', 'Paris Hilton'];
    } else {
      // Marcas para hombre (8 marcas)
      marcas = ['Bharara', 'Paco Rabanne', 'Hugo Boss', 'Ralph Lauren', 'Lattafa', 'Paris Hilton', 'Calvin Klein', 'Carolina Herrera'];
    }
    
    // Agregar opciÃ³n de "Ver Todas"
    const linkTodas = document.createElement('a');
    linkTodas.className = 'marca-filtro';
    if (marcaSeleccionada === null) {
      linkTodas.classList.add('active');
    }
    linkTodas.innerHTML = '<i class="fas fa-list"></i> Ver Todas';
    linkTodas.style.fontWeight = 'bold';
    linkTodas.onclick = () => filtrarPorMarca(null);
    marcasList.appendChild(linkTodas);
    
    // Agregar divisor
    const divisor = document.createElement('div');
    divisor.style.height = '1px';
    divisor.style.background = 'var(--border)';
    divisor.style.margin = '8px 0';
    marcasList.appendChild(divisor);
    
    marcas.forEach(marca => {
      const link = document.createElement('a');
      link.className = 'marca-filtro';
      if (marcaSeleccionada === marca) {
        link.classList.add('active');
      }
      link.textContent = marca;
      link.onclick = () => filtrarPorMarca(marca);
      marcasList.appendChild(link);
    });
  }

  function realizarBusqueda() {
    const input = document.getElementById('search-input').value;
    palabraBusqueda = input.toLowerCase();
    mostrarProductos();
  }

  function renderRatingStars(rating, count) {
    const filled = Math.round(Number(rating || 0));
    let stars = '';
    for (let i = 1; i <= 5; i++) {
      const cls = i <= filled ? 'star filled disabled' : 'star disabled';
      stars += `<span class="${cls}">â˜…</span>`;
    }
    const total = Number(count || 0);
    return `
      <div class="rating">
        ${stars}
      </div>
    `;
  }

  function mostrarProductos() {
    const div = document.getElementById('productos');
    div.innerHTML = '';
    
    let productosAMostrar = todosLosProductos;

    // Primero filtrar por gÃ©nero siempre
    if (generoSeleccionado) {
      const genero = generoSeleccionado.toLowerCase().trim();
      productosAMostrar = productosAMostrar.filter(p => {
        const sub = (p.subcategoria || '').toLowerCase().trim();
        return sub === genero;
      });
    }

    // Luego, si hay bÃºsqueda, filtrar por nombre o marca
    if (palabraBusqueda) {
      const needle = palabraBusqueda.toLowerCase().trim();
      productosAMostrar = productosAMostrar.filter(p => {
        const nombre = (p.nombre || '').toLowerCase().trim();
        const marca = (p.marca || '').toLowerCase().trim();
        return nombre.includes(needle) || marca.includes(needle);
      });
    } else if (marcaSeleccionada) {
      // Si hay marca seleccionada, filtrar por marca exacta
      const needle = marcaSeleccionada.toLowerCase().trim();
      productosAMostrar = productosAMostrar.filter(p => {
        const brand = (p.marca || '').toLowerCase().trim();
        return brand === needle;
      });
    }
    
    if (productosAMostrar.length === 0) {
      div.innerHTML = '<div style="text-align: center; grid-column: 1/-1; padding: 60px 20px;"><p style="color: #999; font-size: 1.1em; margin-bottom: 15px;">No hay productos disponibles</p><p style="color: #ccc; font-size: 0.95em;">Intenta con otros filtros</p></div>';
    } else {
      const esAdmin = usuario && usuario.rol === 'admin';
      productosAMostrar.forEach(p => {
        const stockValue = Number(p.stock || 0);
        const stockLabel = stockValue > 0 ? 'En Stock' : 'Agotado';
        const stockClass = stockValue > 0 ? 'stock-in' : 'stock-out';
        const ratingHtml = renderRatingStars(p.rating, p.ratingCount);
        div.innerHTML += `
          <div class="producto-card" style="cursor: pointer; position: relative;">
            ${esAdmin ? `
              <div style="position: absolute; top: 10px; right: 10px; display: flex; gap: 6px; z-index: 10;">
                <button onclick="event.stopPropagation(); abrirModalEditar('${p._id}')" style="background: linear-gradient(135deg, var(--primary) 0%, #17a085 100%); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85em; font-weight: 600; box-shadow: 0 2px 8px rgba(32, 185, 151, 0.3);" title="Editar producto"><i class="fas fa-edit"></i></button>
                <button onclick="event.stopPropagation(); eliminarProducto('${p._id}')" style="background: linear-gradient(135deg, #ff6b6b 0%, #ff1744 100%); color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.85em; font-weight: 700; box-shadow: 0 2px 8px rgba(255, 59, 48, 0.3);" title="Eliminar producto"><i class="fas fa-trash"></i></button>
              </div>
            ` : ''}
            <div onclick="abrirDetalleProducto('${p._id}')">
              <div class="producto-card-img">
                <img src="${p.imagen ? (p.imagen.startsWith('http') ? p.imagen : API_URL + '/' + encodeURI(p.imagen)) : 'https://via.placeholder.com/280x280?text=Perfume'}" alt="${p.nombre}">
              </div>
              <div class="producto-info">
                <h3>${p.nombre}</h3>
                ${ratingHtml}
                <span class="stock-badge ${stockClass}">${stockLabel}</span>
                <div class="product-price-section">
                  <span class="product-price">$${p.precio}</span>
                </div>
              </div>
            </div>
          </div>
        `;
      });
    }
  }
  

  function comprar(id) {
    const product = todosLosProductos.find(p => p._id === id);
    if (product) {
      const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      carrito.push(product);
      localStorage.setItem('carrito', JSON.stringify(carrito));
      alert('Producto agregado al carrito');
    }
  }

  function logout() {
    if (confirm('Â¿EstÃ¡s segura de que deseas cerrar sesiÃ³n?')) {
      localStorage.removeItem('usuario');
      localStorage.removeItem('carrito');
      window.location.replace('index.html');
    }
  }

  // ========== MENU DROPDOWN USUARIO ==========
  function toggleDropdown() {
    const dropdown = document.getElementById('dropdown-menu');
    dropdown.classList.toggle('activo');
  }

  function inicializarMenuUsuario() {
    let usuarioLocal = null;
    try {
      usuarioLocal = JSON.parse(localStorage.getItem('usuario'));
    } catch (e) {
      usuarioLocal = null;
    }
    if (!usuarioLocal) return;

    const nombreBtn = document.getElementById('nombre-btn');
    const avatarBtn = document.getElementById('avatar-btn');
    const dropdownNombre = document.getElementById('dropdown-nombre');
    const dropdownEmail = document.getElementById('dropdown-email');

    if (nombreBtn) nombreBtn.textContent = usuarioLocal.nombre || 'Usuario';
    if (avatarBtn && usuarioLocal.rol === 'admin') avatarBtn.textContent = 'ðŸ‘‘';
    if (dropdownNombre) dropdownNombre.textContent = usuarioLocal.nombre || 'Usuario';
    if (dropdownEmail) dropdownEmail.textContent = usuarioLocal.email || 'usuario@email.com';
  }

  // FUNCIONES DE NOTIFICACIONES
  function toggleNotificaciones() {
    const dropdown = document.getElementById('notif-dropdown');
    dropdown.classList.toggle('activo');
    if (dropdown.classList.contains('activo')) {
      cargarNotificaciones();
    }
  }

  function cargarNotificaciones() {
    const notificaciones = JSON.parse(localStorage.getItem('notificaciones')) || [];
    const lista = document.getElementById('notif-lista');
    
    if (notificaciones.length === 0) {
      lista.innerHTML = '<div class="notif-vacia">No tienes notificaciones</div>';
      return;
    }
    
    lista.innerHTML = notificaciones.map(notif => `
      <div class="notif-item ${!notif.leida ? 'no-leida' : ''}" onclick="marcarComoLeida(${notif.id})">
        <div class="notif-icon">
          <i class="fas fa-${notif.tipo === 'productos' ? 'box-open' : 'bell'}"></i>
        </div>
        <div class="notif-content">
          <p class="notif-mensaje">${notif.mensaje}</p>
          <div class="notif-fecha">${formatearFecha(notif.fecha)}</div>
        </div>
      </div>
    `).join('');
  }

  function marcarComoLeida(id) {
    const notificaciones = JSON.parse(localStorage.getItem('notificaciones')) || [];
    const notif = notificaciones.find(n => n.id === id);
    if (notif && !notif.leida) {
      notif.leida = true;
      localStorage.setItem('notificaciones', JSON.stringify(notificaciones));
      actualizarContadorNotificaciones();
      cargarNotificaciones();
    }
  }

  function marcarTodasLeidas() {
    const notificaciones = JSON.parse(localStorage.getItem('notificaciones')) || [];
    notificaciones.forEach(n => n.leida = true);
    localStorage.setItem('notificaciones', JSON.stringify(notificaciones));
    actualizarContadorNotificaciones();
    cargarNotificaciones();
  }

  function actualizarContadorNotificaciones() {
    const notificaciones = JSON.parse(localStorage.getItem('notificaciones')) || [];
    const noLeidas = notificaciones.filter(n => !n.leida).length;
    const badge = document.getElementById('notif-count');
    
    if (badge && noLeidas > 0) {
      badge.textContent = noLeidas > 99 ? '99+' : noLeidas;
      badge.style.display = 'flex';
    } else if (badge) {
      badge.style.display = 'none';
    }
  }

  function formatearFecha(fechaISO) {
    const fecha = new Date(fechaISO);
    const ahora = new Date();
    const diff = Math.floor((ahora - fecha) / 1000);
    
    if (diff < 60) return 'Hace un momento';
    if (diff < 3600) return `Hace ${Math.floor(diff / 60)} min`;
    if (diff < 86400) return `Hace ${Math.floor(diff / 3600)} h`;
    if (diff < 604800) return `Hace ${Math.floor(diff / 86400)} dÃ­as`;
    return fecha.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' });
  }

  // Mostrar botÃ³n de notificaciones solo para usuarios (no admin)
  const notifUsuario = document.getElementById('notif-usuario');
  if (notifUsuario) {
    if (usuario && usuario.rol !== 'admin') {
      actualizarContadorNotificaciones();
    } else {
      notifUsuario.style.display = 'none';
    }
  }

  // Cerrar dropdown al hacer click fuera
  document.addEventListener('click', (e) => {
    const userMenu = document.querySelector('.user-menu');
    const dropdown = document.getElementById('dropdown-menu');
    const notifMenu = document.getElementById('notif-usuario');
    const notifDropdown = document.getElementById('notif-dropdown');
    
    if (userMenu && !userMenu.contains(e.target)) {
      dropdown.classList.remove('activo');
    }
    
    if (notifDropdown && notifMenu && !notifMenu.contains(e.target)) {
      notifDropdown.classList.remove('activo');
    }
  });

  function irA(pagina) {
    document.getElementById('dropdown-menu').classList.remove('activo');
    window.location.href = pagina;
  }

  function logoutFromDropdown() {
    document.getElementById('dropdown-menu').classList.remove('activo');
    logout();
  }

  // === FUNCIONES DE NOTIFICACIONES ===
  function toggleNotificaciones() {
    const dropdown = document.getElementById('notif-dropdown');
    dropdown.classList.toggle('activo');
    if (dropdown.classList.contains('activo')) {
      cargarNotificaciones();
    }
  }

  function cargarNotificaciones() {
    const notificaciones = JSON.parse(localStorage.getItem('notificaciones')) || [];
    const lista = document.getElementById('notif-lista');
    
    if (notificaciones.length === 0) {
      lista.innerHTML = '<div class="notif-vacia">No tienes notificaciones</div>';
      return;
    }
    
    lista.innerHTML = notificaciones.map(notif => `
      <div class="notif-item ${!notif.leida ? 'no-leida' : ''}" onclick="marcarComoLeida(${notif.id})">
        <div class="notif-icon">
          <i class="fas fa-${notif.tipo === 'productos' ? 'box-open' : 'bell'}"></i>
        </div>
        <div class="notif-content">
          <p class="notif-mensaje">${notif.mensaje}</p>
          <div class="notif-fecha">${formatearFecha(notif.fecha)}</div>
        </div>
      </div>
    `).join('');
  }

  function marcarComoLeida(id) {
    const notificaciones = JSON.parse(localStorage.getItem('notificaciones')) || [];
    const notif = notificaciones.find(n => n.id === id);
    if (notif && !notif.leida) {
      notif.leida = true;
      localStorage.setItem('notificaciones', JSON.stringify(notificaciones));
      actualizarContadorNotificaciones();
      cargarNotificaciones();
    }
  }

  function marcarTodasLeidas() {
    const notificaciones = JSON.parse(localStorage.getItem('notificaciones')) || [];
    notificaciones.forEach(n => n.leida = true);
    localStorage.setItem('notificaciones', JSON.stringify(notificaciones));
    actualizarContadorNotificaciones();
    cargarNotificaciones();
  }

  function actualizarContadorNotificaciones() {
    const notificaciones = JSON.parse(localStorage.getItem('notificaciones')) || [];
    const noLeidas = notificaciones.filter(n => !n.leida).length;
    const badge = document.getElementById('notif-count');
    
    if (badge && noLeidas > 0) {
      badge.textContent = noLeidas > 99 ? '99+' : noLeidas;
      badge.style.display = 'flex';
    } else if (badge) {
      badge.style.display = 'none';
    }
  }

  function formatearFecha(fechaISO) {
    const fecha = new Date(fechaISO);
    const ahora = new Date();
    const diff = Math.floor((ahora - fecha) / 1000);
    
    if (diff < 60) return 'Hace un momento';
    if (diff < 3600) return `Hace ${Math.floor(diff / 60)} min`;
    if (diff < 86400) return `Hace ${Math.floor(diff / 3600)} h`;
    if (diff < 604800) return `Hace ${Math.floor(diff / 86400)} dÃ­as`;
    return fecha.toLocaleDateString('es-ES', { day: 'numeric', month: 'short' });
  }

  // Cerrar dropdown al hacer click fuera
  document.addEventListener('click', (e) => {
    const userMenu = document.querySelector('.user-menu');
    const dropdown = document.getElementById('dropdown-menu');
    
    if (userMenu && !userMenu.contains(e.target)) {
      dropdown.classList.remove('activo');
    }
  });

  function logout() {
    if (confirm('Â¿EstÃ¡s segura de que deseas cerrar sesiÃ³n?')) {
      localStorage.removeItem('usuario');
      localStorage.removeItem('carrito');
      window.location.replace('index.html');
    }
  }

  // Cerrar dropdown al hacer click fuera
  document.addEventListener('click', (e) => {
    const dropdown = document.getElementById('dropdownMarcas');
    const container = e.target.closest('.dropdown-container');
    if (!container && dropdown && dropdown.style.display === 'block') {
      dropdown.style.display = 'none';
    }
  });


  function obtenerEtiquetaCalificacion(rating, count) {
    const total = Number(count || 0);
    const value = Number(rating || 0);
    if (total === 0) return 'Nuevo';
    if (value >= 4.6) return 'Excelente';
    if (value >= 4.1) return 'Muy buena';
    if (value >= 3.6) return 'Buena';
    if (value >= 3.0) return 'Regular';
    return 'Baja';
  }

  async function calificar(id, value) {
    if (!usuario || usuario.rol !== 'cliente') {
      alert('Solo los clientes pueden calificar');
      return;
    }
    try {
      const res = await fetch(`${API_URL}/api/products/${id}/rate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ value })
      });
      if (!res.ok) {
        alert('No se pudo enviar tu calificaciÃ³n');
        return;
      }
      const data = await res.json();
      const idx = todosLosProductos.findIndex(p => p._id === id);
      if (idx >= 0) {
        todosLosProductos[idx].rating = data.rating;
        todosLosProductos[idx].ratingCount = data.ratingCount;
      }
      mostrarProductos();
    } catch (e) {
      alert('Error de conexiÃ³n al calificar');
    }
  }

  // Comentarios en localStorage
  let comentariosGuardados = JSON.parse(localStorage.getItem('comentarios')) || {};

  async function enviarComentario(productId) {
    const usuarioGuardado = JSON.parse(localStorage.getItem('usuario'));
    if (!usuarioGuardado || usuarioGuardado.rol !== 'cliente') {
      alert('Solo los clientes pueden comentar');
      return;
    }

    const textarea = document.getElementById(`comentario-${productId}`);
    const texto = textarea.value.trim();
    
    if (!texto) {
      alert('Escribe un comentario');
      return;
    }

    const nombreUsuario = usuarioGuardado?.nombre || 'AnÃ³nimo';

    // Guardar comentario en localStorage
    if (!comentariosGuardados[productId]) {
      comentariosGuardados[productId] = [];
    }
    
    comentariosGuardados[productId].push({
      usuario: nombreUsuario,
      texto: texto,
      fecha: new Date().toLocaleDateString('es-ES'),
      respuesta: null
    });

    localStorage.setItem('comentarios', JSON.stringify(comentariosGuardados));
    textarea.value = '';
    mostrarProductos();
  }

  function mostrarComentarios(productId) {
    const container = document.getElementById(`comentarios-seccion-${productId}`);
    if (!container) return;

    const usuarioGuardado = JSON.parse(localStorage.getItem('usuario'));
    const esCliente = usuarioGuardado?.rol === 'cliente';
    const esAdmin = usuarioGuardado?.rol === 'admin';
    const comentarios = comentariosGuardados[productId] || [];

    let html = '<div class="comentarios-section">';

    // Si es cliente, mostrar formulario para comentar
    if (esCliente) {
      html += `
        <div class="comentario-form">
          <textarea id="comentario-${productId}" placeholder="Deja tu comentario..." maxlength="150"></textarea>
          <button onclick="enviarComentario('${productId}')">ðŸ’¬ Comentar</button>
        </div>
      `;
    } else if (esAdmin) {
      // Si es admin, mostrar encabezado
      html += `<div style="font-size: 0.75em; font-weight: 600; color: var(--primary); margin-bottom: 6px;">ðŸ“‹ Comentarios (${comentarios.length})</div>`;
    }

    // Mostrar comentarios (Ãºltimos 3 para usuarios, todos para admin)
    const mostrarHasta = esAdmin ? comentarios.length : 3;
    html += '<div class="comentarios-lista">';

    comentarios.slice(-mostrarHasta).forEach((c, index) => {
      const posicion = comentarios.length - mostrarHasta + index;
      html += `
        <div class="comentario-item">
          <div class="comentario-usuario">${c.usuario}</div>
          <div class="comentario-texto">${c.texto}</div>
          <div style="font-size: 0.65em; color: #999; margin-top: 2px;">${c.fecha}</div>
          ${c.respuesta ? `<div style="margin-top: 8px; padding: 6px 8px; background: rgba(32, 185, 151, 0.1); border-left: 3px solid #20B997; border-radius: 4px;"><div style="font-size: 0.65em; font-weight: 700; color: #0B5345;">âœ“ Respuesta Admin</div><div style="font-size: 0.7em; color: #0B5345; margin-top: 3px;">${c.respuesta}</div></div>` : ''}
          ${esAdmin ? `<button onclick="abrirFormRespuesta('${productId}', ${posicion})" style="font-size: 0.65em; background: #20B997; color: white; border: none; padding: 2px 6px; border-radius: 4px; cursor: pointer; margin-top: 3px; margin-right: 4px;">ðŸ’¬ Responder</button><button onclick="eliminarComentario('${productId}', ${posicion})" style="font-size: 0.65em; background: #ff6b6b; color: white; border: none; padding: 2px 6px; border-radius: 4px; cursor: pointer; margin-top: 3px;">ðŸ—‘ï¸ Eliminar</button>` : ''}
        </div>
      `;
    });

    html += '</div></div>';
    container.innerHTML = html;
  }

  function eliminarComentario(productId, index) {
    if (confirm('Â¿Eliminar este comentario?')) {
      if (comentariosGuardados[productId] && comentariosGuardados[productId][index]) {
        comentariosGuardados[productId].splice(index, 1);
        localStorage.setItem('comentarios', JSON.stringify(comentariosGuardados));
        mostrarProductos();
      }
    }
  }

  // ========== DETALLE DE PRODUCTO EN MODAL ==========
  let productoActualEnModal = null;

  function abrirDetalleProducto(productId) {
    productoActualEnModal = todosLosProductos.find(p => p._id === productId);
    if (!productoActualEnModal) return;

    // Llenar informaciÃ³n del producto
    document.getElementById('modal-titulo').textContent = productoActualEnModal.nombre;
    document.getElementById('modal-marca').textContent = productoActualEnModal.marca || 'Marca';
    document.getElementById('modal-precio').textContent = productoActualEnModal.precio;
    document.getElementById('modal-imagen').src = productoActualEnModal.imagen 
      ? (productoActualEnModal.imagen.startsWith('http') ? productoActualEnModal.imagen : API_URL + '/' + encodeURI(productoActualEnModal.imagen))
      : 'https://via.placeholder.com/280x280?text=Perfume';

    // Mostrar rating
    const isCliente = usuario && usuario.rol === 'cliente';
    const filled = Math.round(Number(productoActualEnModal.rating || 0));
    let stars = '';
    for (let i = 1; i <= 5; i++) {
      const cls = i <= filled ? 'star filled' : 'star';
      const starClass = isCliente ? cls : `${cls} disabled`;
      const click = isCliente ? `onclick=\"calificar('${productId}', ${i})\"` : '';
      stars += `<span class="${starClass}" ${click}>â˜…</span>`;
    }
    const ratingLabel = obtenerEtiquetaCalificacion(productoActualEnModal.rating, productoActualEnModal.ratingCount);
    document.getElementById('modal-rating').innerHTML = stars + ` <span class="rating-label">${ratingLabel}</span>`;

    // Mostrar comentarios
    mostrarComentariosEnModal(productId);

    // Mostrar modal
    document.getElementById('modal-detalle').style.display = 'flex';
  }

  function cerrarDetalleProducto() {
    document.getElementById('modal-detalle').style.display = 'none';
    productoActualEnModal = null;
  }

  function comprarDesdeDetalle() {
    if (productoActualEnModal) {
      abrirModalCantidad(productoActualEnModal._id, productoActualEnModal.nombre);
    }
  }

  function abrirModalCantidad(productId, productName) {
    // Mostrar modal de cantidad
    document.getElementById('modal-cantidad-producto-id').value = productId;
    document.getElementById('modal-cantidad-producto-nombre').textContent = productName;
    document.getElementById('modal-cantidad-input').value = 1;
    document.getElementById('cantidad-modal').style.display = 'flex';
  }

  function cerrarModalCantidad() {
    document.getElementById('cantidad-modal').style.display = 'none';
  }

  function confirmarCantidad() {
    const productId = document.getElementById('modal-cantidad-producto-id').value;
    const cantidad = parseInt(document.getElementById('modal-cantidad-input').value) || 1;
    const producto = productoActualEnModal || todosLosProductos.find(p => p._id === productId);
    
    if (cantidad < 1) {
      alert('La cantidad debe ser al menos 1');
      return;
    }
    
    if (cantidad > (producto?.stock || 0)) {
      alert(`Solo hay ${producto?.stock || 0} disponibles`);
      return;
    }
    
    agregarAlCarrito(productId, producto?.nombre || 'Producto', producto?.precio || 0, '', cantidad);
    cerrarModalCantidad();
    cerrarDetalleProducto();
  }

  function mostrarComentariosEnModal(productId) {
    const container = document.getElementById('modal-comentarios');
    const usuarioGuardado = JSON.parse(localStorage.getItem('usuario'));
    const esCliente = usuarioGuardado?.rol === 'cliente';
    const esAdmin = usuarioGuardado?.rol === 'admin';
    const comentarios = comentariosGuardados[productId] || [];

    let html = '';

    // Si es cliente, mostrar formulario para comentar
    if (esCliente) {
      html += `
        <div class="comentario-form">
          <textarea id="comentario-modal-${productId}" placeholder="Deja tu comentario..." maxlength="150"></textarea>
          <button onclick="enviarComentarioDesdeModal('${productId}')">ðŸ’¬ Comentar</button>
        </div>
      `;
    } else if (esAdmin) {
      // Si es admin, mostrar encabezado
      html += `<div style="font-size: 0.85em; font-weight: 600; color: var(--primary); margin-bottom: 10px;">ðŸ“‹ Comentarios (${comentarios.length})</div>`;
    }

    // Mostrar comentarios (Ãºltimos 3 para usuarios, todos para admin)
    const mostrarHasta = esAdmin ? comentarios.length : 3;
    html += '<div class="comentarios-lista">';

    if (comentarios.length === 0) {
      html += '<div style="text-align: center; color: #999; font-size: 0.85em; padding: 10px;">Sin comentarios aÃºn. Â¡SÃ© el primero!</div>';
    } else {
      comentarios.slice(-mostrarHasta).forEach((c, index) => {
        const posicion = comentarios.length - mostrarHasta + index;
        html += `
          <div class="comentario-item">
            <div class="comentario-usuario">${c.usuario}</div>
            <div class="comentario-texto">${c.texto}</div>
            <div style="font-size: 0.65em; color: #999; margin-top: 2px;">${c.fecha}</div>
            ${c.respuesta ? `<div style="margin-top: 8px; padding: 6px 8px; background: rgba(32, 185, 151, 0.1); border-left: 3px solid #20B997; border-radius: 4px;"><div style="font-size: 0.65em; font-weight: 700; color: #0B5345;">âœ“ Respuesta Admin</div><div style="font-size: 0.7em; color: #0B5345; margin-top: 3px;">${c.respuesta}</div></div>` : ''}
            ${esAdmin ? `<button onclick="abrirFormRespuesta('${productId}', ${posicion})" style="font-size: 0.7em; background: #20B997; color: white; border: none; padding: 3px 8px; border-radius: 4px; cursor: pointer; margin-top: 6px; margin-right: 4px;">ðŸ’¬ Responder</button><button onclick="eliminarComentario('${productId}', ${posicion})" style="font-size: 0.7em; background: #ff6b6b; color: white; border: none; padding: 3px 8px; border-radius: 4px; cursor: pointer; margin-top: 6px;">ðŸ—‘ï¸ Eliminar</button>` : ''}
          </div>
        `;
      });
    }

    html += '</div>';
    container.innerHTML = html;
  }

  function abrirFormRespuesta(productId, index) {
    const respuesta = prompt('Escribe la respuesta para este comentario:');
    if (respuesta === null) return;
    if (!respuesta.trim()) {
      alert('La respuesta no puede estar vacÃ­a');
      return;
    }
    if (comentariosGuardados[productId] && comentariosGuardados[productId][index]) {
      comentariosGuardados[productId][index].respuesta = respuesta.trim();
      localStorage.setItem('comentarios', JSON.stringify(comentariosGuardados));
      mostrarProductos();
      mostrarComentariosEnModal(productId);
    }
  }

  function enviarComentarioDesdeModal(productId) {
    const usuarioGuardado = JSON.parse(localStorage.getItem('usuario'));
    if (!usuarioGuardado || usuarioGuardado.rol !== 'cliente') {
      alert('Solo los clientes pueden comentar');
      return;
    }

    const textarea = document.getElementById(`comentario-modal-${productId}`);
    const texto = textarea.value.trim();
    if (!texto) return;

    const usuario = usuarioGuardado?.nombre || 'AnÃ³nimo';

    const comentario = {
      usuario: usuario,
      texto: texto,
      fecha: new Date().toLocaleDateString('es-ES'),
      respuesta: null
    };

    if (!comentariosGuardados[productId]) {
      comentariosGuardados[productId] = [];
    }

    comentariosGuardados[productId].push(comentario);
    localStorage.setItem('comentarios', JSON.stringify(comentariosGuardados));

    textarea.value = '';
    mostrarComentariosEnModal(productId);
  }

  // ========== CARRUSEL DESTACADOS ==========
  let currentSlide = 0;
  let carouselItems = [];

  async function inicializarCarrusel() {
    try {
      const res = await fetch(API_URL + '/api/products?categoria=perfumes');
      const productos = await res.json();
      
      // Filtrar productos por el gÃ©nero seleccionado (case-insensitive)
      const productosFiltrados = productos.filter(p => 
        (p.subcategoria || '').toLowerCase() === generoSeleccionado.toLowerCase()
      );

      carouselItems = productosFiltrados.slice(0, 5); // 5 productos del gÃ©nero seleccionado
      
      if (carouselItems.length === 0) {
        document.querySelector('.carousel-section').style.display = 'none';
        return;
      }
      
      // Mostrar carrusel si hay productos
      document.querySelector('.carousel-section').style.display = 'block';
      
      renderCarouselSlides();
      renderCarouselDots();
      startAutoPlay();
    } catch (error) {
      console.error('Error cargando carrusel:', error);
    }
  }

  function renderCarouselSlides() {
    const track = document.getElementById('carouselTrack');
    track.innerHTML = '';
    
    carouselItems.forEach((item, index) => {
      const slide = document.createElement('div');
      slide.className = item.type === 'banner' ? 'carousel-slide banner' : 'carousel-slide';

      if (item.type === 'banner') {
        slide.style.backgroundImage = `url('${item.image}')`;
        slide.innerHTML = `
          <div class="carousel-content">
            <h2>${item.titulo}</h2>
            <p>${item.subtitulo}</p>
            <button class="btn-comprar" onclick="document.getElementById('productos').scrollIntoView({ behavior: 'smooth' })">
              <i class="fas fa-star"></i> Ver colecciÃ³n
            </button>
          </div>
          <div class="carousel-img"></div>
        `;
      } else {
        const imagenSrc = item.imagen ? (item.imagen.startsWith('http') ? item.imagen : `http://localhost:3000/${item.imagen}`) : 'https://via.placeholder.com/400x300?text=Perfume';
        slide.style.backgroundImage = `url('${imagenSrc}')`;
        slide.innerHTML = `
          <div class="carousel-content">
            <h2>${item.nombre}</h2>
            <p><strong>${item.marca}</strong></p>
            <div class="carousel-price">$${Number(item.precio).toFixed(2)}</div>
            <p style="font-size: 0.85em; color: #666;">Stock: ${item.stock} disponibles</p>
            <button class="btn-comprar" onclick="agregarAlCarrito('${item._id}', '${item.nombre}', ${item.precio}, '${imagenSrc.replace(/'/g, "\\'")}')">
              <i class="fas fa-shopping-bag"></i> Agregar
            </button>
          </div>
          <div class="carousel-img">
            <img src="${imagenSrc}" alt="${item.nombre}">
          </div>
        `;
      }
      track.appendChild(slide);
    });
  }

  function renderCarouselDots() {
    const dots = document.getElementById('carouselDots');
    dots.innerHTML = '';
    
    carouselItems.forEach((_, index) => {
      const dot = document.createElement('div');
      dot.className = `carousel-dot ${index === 0 ? 'active' : ''}`;
      dot.onclick = () => goToSlide(index);
      dots.appendChild(dot);
    });
  }

  function showSlide(index) {
    if (index >= carouselItems.length) currentSlide = 0;
    if (index < 0) currentSlide = carouselItems.length - 1;
    
    const track = document.getElementById('carouselTrack');
    track.style.transform = `translateX(-${currentSlide * 100}%)`;
    
    document.querySelectorAll('.carousel-dot').forEach((dot, i) => {
      dot.classList.toggle('active', i === currentSlide);
    });
  }

  function nextSlide() {
    currentSlide++;
    if (currentSlide >= carouselItems.length) currentSlide = 0;
    showSlide(currentSlide);
    resetAutoPlay();
  }

  function prevSlide() {
    currentSlide--;
    if (currentSlide < 0) currentSlide = carouselItems.length - 1;
    showSlide(currentSlide);
    resetAutoPlay();
  }

  function goToSlide(index) {
    currentSlide = index;
    showSlide(currentSlide);
    resetAutoPlay();
  }

  let autoPlayInterval;

  function startAutoPlay() {
    autoPlayInterval = setInterval(() => {
      currentSlide++;
      if (currentSlide >= carouselItems.length) currentSlide = 0;
      showSlide(currentSlide);
    }, 5000); // Cambiar slide cada 5 segundos
  }

  function resetAutoPlay() {
    clearInterval(autoPlayInterval);
    startAutoPlay();
  }

  function agregarAlCarrito(id, nombre, precio, imagen, cantidad = 1) {
    fetch(API_URL + '/api/products?categoria=perfumes')
      .then(res => res.json())
      .then(data => {
        const product = data.find(p => p._id === id);
        if (product) {
          const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
          
          // Verificar si el producto ya estÃ¡ en el carrito
          const productoExistente = carrito.find(item => item._id === id);
          
          if (productoExistente) {
            // Si existe, incrementar la cantidad
            productoExistente.cantidad = (productoExistente.cantidad || 1) + parseInt(cantidad);
          } else {
            // Si no existe, agregarlo con la cantidad especificada
            product.cantidad = parseInt(cantidad);
            carrito.push(product);
          }
          
          localStorage.setItem('carrito', JSON.stringify(carrito));
          alert(`âœ… ${nombre} (x${cantidad}) agregado al carrito`);
        }
      });
  }

  // ========== FUNCIONES DE EDICIÃ“N DE PRODUCTOS ==========
  function abrirModalEditar(id) {
    if (!(usuario && usuario.rol === 'admin')) {
      alert('Solo los administradores pueden editar productos');
      return;
    }
    const producto = todosLosProductos.find(p => p._id === id);
    if (!producto) {
      alert('Producto no encontrado');
      return;
    }

    // Llenar el formulario con los datos del producto
    document.getElementById('edit-producto-id').value = producto._id;
    document.getElementById('edit-nombre').value = producto.nombre || '';
    document.getElementById('edit-precio').value = producto.precio || '';
    document.getElementById('edit-marca').value = producto.marca || '';
    document.getElementById('edit-categoria').value = producto.categoria || 'perfumes';
    document.getElementById('edit-subcategoria').value = producto.subcategoria || 'hombre';
    document.getElementById('edit-stock').value = producto.stock || 0;
    document.getElementById('edit-descripcion').value = producto.descripcion || '';
    document.getElementById('edit-imagen').value = ''; // Dejar vacÃ­o por defecto

    // Mostrar el modal
    document.getElementById('modal-editar-producto').style.display = 'flex';
  }

  function cerrarModalEditar() {
    document.getElementById('modal-editar-producto').style.display = 'none';
    document.getElementById('form-editar-producto').reset();
  }

  async function guardarEdicionProducto(event) {
    event.preventDefault();

    const id = document.getElementById('edit-producto-id').value;
    const formData = new FormData();
    formData.append('nombre', document.getElementById('edit-nombre').value);
    formData.append('precio', document.getElementById('edit-precio').value);
    formData.append('marca', document.getElementById('edit-marca').value);
    formData.append('categoria', document.getElementById('edit-categoria').value);
    formData.append('subcategoria', document.getElementById('edit-subcategoria').value);
    formData.append('stock', document.getElementById('edit-stock').value);
    formData.append('descripcion', document.getElementById('edit-descripcion').value);

    const imagenFile = document.getElementById('edit-imagen').files[0];
    if (imagenFile) {
      formData.append('imagen', imagenFile);
    }

    try {
      const response = await fetch(`${API_URL}/api/products/${id}`, {
        method: 'PUT',
        body: formData
      });

      if (!response.ok) {
        throw new Error('Error al actualizar el producto');
      }

      const resultado = await response.json();
      
      // Actualizar el producto en el array local
      const index = todosLosProductos.findIndex(p => p._id === id);
      if (index !== -1) {
        todosLosProductos[index] = resultado;
      }

      // Cerrar el modal y recargar productos
      cerrarModalEditar();
      mostrarProductos();
      inicializarCarrusel();
      
      alert('âœ… Producto actualizado exitosamente');
    } catch (error) {
      console.error('Error:', error);
      alert('âŒ Error al actualizar el producto: ' + error.message);
    }
  }

  async function eliminarProducto(id) {
    if (!(usuario && usuario.rol === 'admin')) {
      alert('Solo los administradores pueden eliminar productos');
      return;
    }
    const producto = todosLosProductos.find(p => p._id === id);
    const nombre = producto ? producto.nombre : 'este producto';
    if (!confirm(`Â¿Eliminar ${nombre}? Esta accion no se puede deshacer.`)) {
      return;
    }
    try {
      const response = await fetch(`${API_URL}/api/products/${id}`, {
        method: 'DELETE'
      });
      if (!response.ok) {
        throw new Error('No se pudo eliminar el producto');
      }
      todosLosProductos = todosLosProductos.filter(p => p._id !== id);
      mostrarProductos();
      inicializarCarrusel();
      alert('âœ… Producto eliminado');
    } catch (error) {
      console.error('Error:', error);
      alert('âŒ Error al eliminar el producto: ' + error.message);
    }
  }

  // Cerrar modal al hacer clic fuera de Ã©l
  document.addEventListener('click', function(event) {
    const modal = document.getElementById('modal-editar-producto');
    if (event.target === modal) {
      cerrarModalEditar();
    }
  });

</script>
</div>

<!-- Footer -->
<div class="footer">
  <div class="footer-links">
    <a href="perfumes.html"><i class="fas fa-flower"></i> Perfumes</a>
    <a href="devoluciones.html"><i class="fas fa-undo"></i> Devoluciones</a>
    <a href="mailto:compras.sofishop@gmail.com"><i class="fas fa-envelope"></i> compras.sofishop@gmail.com</a>
    <a href="https://wa.me/593984050732?text=Hola%2C%20me%20interesa%20informaci%C3%B3n%20sobre%20los%20perfumes%20de%20SofiShop" target="_blank"><i class="fab fa-whatsapp"></i> +593 098 405 0732</a>
  </div>
  <p>&copy; 2026 <strong>SofiShop</strong> â€¢ Perfumes de Calidad â€¢ Todos los derechos reservados.</p>
</div>
</div>

<!-- MODAL DETALLE DE PRODUCTO -->
<div id="modal-detalle" class="modal" style="display: none;">
  <div class="modal-content" style="width: 90%; max-width: 700px; max-height: 85vh; overflow-y: auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2 id="modal-titulo" style="color: var(--primary); margin: 0;"></h2>
      <button onclick="cerrarDetalleProducto()" style="background: none; border: none; font-size: 1.5em; cursor: pointer; color: #999;">âœ•</button>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
      <div style="background: linear-gradient(135deg, var(--accent) 0%, #f0e8f0 100%); border-radius: 12px; padding: 15px; display: flex; align-items: center; justify-content: center; min-height: 250px;">
        <img id="modal-imagen" src="" alt="" style="max-width: 100%; max-height: 250px; object-fit: contain;">
      </div>
      
      <div>
        <p style="color: var(--secondary); font-size: 14px; font-weight: 600; margin-bottom: 10px;">ðŸ’Ž <span id="modal-marca"></span></p>
        <div class="rating" id="modal-rating" style="margin-bottom: 15px;"></div>
        
        <div style="background: var(--light-bg); padding: 12px; border-radius: 8px; margin-bottom: 15px;">
          <p style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Precio:</p>
          <p style="font-size: 1.3em; font-weight: 700; color: var(--primary);">$<span id="modal-precio"></span></p>
        </div>
        
        <button class="btn-comprar" onclick="comprarDesdeDetalle()" style="width: 100%; margin-bottom: 10px;">
          <i class="fas fa-shopping-bag"></i> Agregar al Carrito
        </button>
      </div>
    </div>
    
    <div style="border-top: 1px solid var(--border); padding-top: 20px;">
      <h3 style="color: var(--secondary); margin-bottom: 10px; font-size: 1em;">Comentarios</h3>
      <div id="modal-comentarios"></div>
    </div>
  </div>
</div>

<!-- MODAL SELECCIONAR CANTIDAD -->
<div id="cantidad-modal" class="modal" style="display: none; z-index: 10000;">
  <div class="modal-content" style="width: 95%; max-width: 400px; text-align: center;">
    <h2 style="color: var(--primary); margin-bottom: 20px;">Â¿CuÃ¡ntos quieres?</h2>
    
    <p style="color: #666; margin-bottom: 20px; font-size: 1.1em;">
      <span id="modal-cantidad-producto-nombre" style="font-weight: 700; color: var(--text);"></span>
    </p>
    
    <div style="background: var(--light-bg); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
      <label for="modal-cantidad-input" style="display: block; margin-bottom: 12px; font-weight: 600; color: var(--text);">Cantidad:</label>
      <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
        <button onclick="document.getElementById('modal-cantidad-input').value = Math.max(1, parseInt(document.getElementById('modal-cantidad-input').value) - 1)" style="width: 40px; height: 40px; border: 2px solid var(--primary); background: white; color: var(--primary); border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 1.2em;">âˆ’</button>
        <input type="number" id="modal-cantidad-input" min="1" max="99" value="1" style="width: 80px; padding: 10px; text-align: center; border: 2px solid var(--primary); border-radius: 8px; font-size: 1.2em; font-weight: 700; color: var(--primary);">
        <button onclick="document.getElementById('modal-cantidad-input').value = parseInt(document.getElementById('modal-cantidad-input').value) + 1" style="width: 40px; height: 40px; border: 2px solid var(--primary); background: white; color: var(--primary); border-radius: 8px; cursor: pointer; font-weight: 700; font-size: 1.2em;">+</button>
      </div>
    </div>
    
    <input type="hidden" id="modal-cantidad-producto-id">
    
    <div style="display: flex; gap: 12px; justify-content: center;">
      <button onclick="cerrarModalCantidad()" style="flex: 1; padding: 12px; border: 2px solid #ddd; background: white; color: #666; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1em;">Cancelar</button>
      <button onclick="confirmarCantidad()" style="flex: 1; padding: 12px; background: linear-gradient(135deg, var(--primary) 0%, #0f9f7f 100%); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 1em; box-shadow: 0 4px 12px rgba(32, 185, 151, 0.3);"><i class="fas fa-check"></i> Agregar</button>
    </div>
  </div>
</div>

</body>
</html>

